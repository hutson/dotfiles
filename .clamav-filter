#!/usr/bin/env bash

#====================================================
# Clamav Filter
#
# This script will scan the standard input using ClamScan and log the file as malware if it's marked as malware by Clamav.
#====================================================

FILE=/tmp/$$_outclam.tmp

clamscan --no-summary --detect-pua=yes --detect-structured=yes - 1> $FILE
if [ $? -eq 1 ]; then
	STRING=$(grep "FOUND" $FILE |cut -d: -f2)
	logger -t clamav/malware < $FILE
	exit 1
fi

exit 0

